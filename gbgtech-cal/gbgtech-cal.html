<head>
	<title>gbgtech-cal</title>
</head>

<body>
	{{> header}}
	{{> menu}}

</body>

<template name="header">
<div class="header">
	<img src="/gbgtech.jpg">
	{{>loginButtons}}
</div>
</template>

<template name="home">
	{{> month}}
</template>

<template name="menu">
	<div id="menu-container" class="menu">
		<a id="menu-open" href="#" class="button" data-state="closed">Menu</a>
		<ul id="menu-list">
			<li class="menu-list-item"><a href="/" class="menu-list-item-link">Home</a></li>
			<li class="menu-list-item"><a href="/event" class="menu-list-item-link">Events</a></li>
			<li class="menu-list-item"><a href="/organization" class="menu-list-item-link">Organizations</a></li>
			{{#if currentUser}}
			<li class="menu-list-item"><a href="/organization/new" class="menu-list-item-link">Create Organization</a></li>
			{{#if inOrg currentUser}}
			<li class="menu-list-item"><a href="/event/new" class="menu-list-item-link">Create Event</a></li>
			<br />
			<li class="menu-list-item"><a href="/admin" class="menu-list-item-link">Admin Panel</a></li>
			{{/if}}
			{{/if}}
		</ul>
	</div>
</template>

<template name="month">
	<input id="prev-month" class="month-nav" type="button" value="<- Previous Month">
	<p class="month-nav">{{currentMonthAndYear}}</p>
	<input id="next-month" class="month-nav" type="button" value="Next Month ->">
	<div id="month-container">
		<table>
			<thead>
				<tr>
					<td>Monday</td>
					<td>Tuesday</td>
					<td>Wednesday</td>
					<td>Thursday</td>
					<td>Friday</td>
					<td>Saturday</td>
					<td>Sunday</td>
				</tr>
			</thead>
			<tbody id="week-container">

			</tbody>
		</table>
	</div>
</template>

<template name="week">
	<tr id="week-{{weekNbr}}"></tr>
</template>

<template name="day">
	<td id="{{id}}">{{date}}</td>
</template>

<template name="eventList">
	<ul>
		{{#each events}}
		<li><a href="/event/{{_id}}">{{date}} - {{name}} by {{getOrg org}}</a></li>
		{{/each}}
	</ul>
</template>

<template name="eventView">
	<input class="back-button button" type="button" value="Back">
	<h2>{{event.name}}</h2>
	<h3>{{event.date}}</h3>
	<h4>by {{getOrg event.org}}</h4>
</template>

<template name="eventCreate">
	<form>
		<input type="text" name="eventName" placeholder="Event name" >
		<label>Organization
			<select name="org">
				{{#each organizations currentUser._id}}
				<option value="{{id}}">{{name}}</option>
				{{/each}}
			</select>
		</label>
		<label>Date
			<input class="datepicker" name="date">
		</label>
		<input class="back-button button" type="button" value="Back">
		<input type="submit" class="button" value="Create event">
	</form>
</template>

<template name="eventEdit">
	<form>
		<input type="text" name="eventName" placeholder="Event name" value="{{event.name}}">
		<label>Organization
			<select name="org">
				{{#each organizations currentUser._id}}
				<option value="{{id}}" {{isSelected _id ../event.org }}>{{name}}</option>
				{{/each}}
			</select>
		</label>
		<label>Date
			<input class="datepicker" name="date">
		</label>
		<input class="back-button button" type="button" value="Back">
		<input type="submit" class="button" value="Edit event">
	</form>
</template>

<template name="orgList">
	<ul>
		{{#each organizations}}
		<li><a href="/organization/{{_id}}">{{name}}</a></li>	
		{{/each}}
	</ul>
</template>

<template name="orgEdit">
	{{#if isOwner org.owner currentUser._id}}
	<form data-id="{{org._id}}">
		<label>Owner
			<select name="owner">
				{{#each org.members}}
				<option value="{{this}}" {{isOwner ../org.owner this}}>{{getUserName this}}</option>
				{{/each}}
			</select>
		</label>
		<input type="text" name="orgName" placeholder="Organization name" required value="{{org.name}}">
		<input class="back-button button" type="button" value="Back">
		<input type="submit" class="button" value="Edit Organization">
	</form>
	{{/if}}
</template>

<template name="orgView">
	<input class="back-button button" type="button" value="Back">
	<h2>{{org.name}}</h2>
	<h3>Owner: {{getMember org.owner}}</h3>
	<h4>Members:</h4>
	<ul>
		{{#each org.members}}
		<li>{{getMember this}}</li>
		{{/each}}
	</ul>
	{{#if isMember org._id currentUser._id}}
	<p>You are a member of this organization.</p>
	{{else}}
	{{#if isRequesting org._id currentUser._id}}
	<p>You are requesting membership in this organization</p>
	{{else}}
	<input id="{{org._id}}" type="button" class="request-membership-button" value="Request membership">
	{{/if}}
	{{/if}}
</template>

<template name="orgCreate">
	<form>
		<label>Owner
			<input type="text" name="orgOwner" value="{{currentUser.profile.name}}" disabled="true">
		</label>
		<input type="text" name="orgName" placeholder="Organization name" required>
		<input class="back-button button" type="button" value="Back">
		<input type="submit" class="button" value="Create Organization">
	</form>
</template>

<template name="adminPanel">
	{{#if currentUser}}
	{{#if isAdmin currentUser}}
	<h3>Site-admin</h3>
	<ul>
		{{#each organizations}}
		{{>adminOrgItem}}
		{{/each}}
	</ul>
	{{else}}
	{{#if inOrg currentUser}}
	<h2>Your organizations</h2>
	<ul>
		{{#each inOrg currentUser}}
		{{>adminOrgItem}}
		{{/each}}
	</ul>
	{{else}}
	<h2>You are not a part of any organization and can therefore not admin any organizations or events</h2>
	{{/if}}
	{{/if}}
	{{else}}
	<h2>You are not logged in, please log in to admin organizations and events.</h2>
	{{>loginButtons}}
	{{/if}}
</template>

<template name="adminOrgItem">
	<li>
		<h4>{{name}}</h4>
		{{#if isOwner owner currentUser._id}}
		<a href="/organization/{{_id}}/edit" class="button">Edit</a>
		<input type="button" class="button delete" data-type="org" data-id="{{_id}}" value="Delete">
		<input type="button" class="button manage-members" value="Manage members">
		<div id="manage-members">
		<ul>
		{{#each members}}
			{{#if isOwner ../owner this}}
			<li>{{getMember this}} - Owner</li>
			{{else}}
			<li>{{getMember this}}<input type="button" class="button delete tiny" data-org="{{../_id}}" data-type="member" data-id="{{this}}" value="Delete"></li>
			{{/if}}
		{{/each}}	
		</ul>
		</div>
		{{/if}}
		{{#if eventsForOrg _id}}
		<h5>Upcoming events</h5>
		<ul>
			{{#each eventsForOrg _id}}
			<li>{{name}} - {{date}} <a href="/event/{{_id}}/edit" class="button tiny">Edit</a><input type="button" class="button tiny delete" data-type="event" data-id="{{_id}}" value="Delete"></li>
			{{/each}}
		</ul>

		{{else}}
		<h5>No upcoming events</h5>
		{{/if}}
		{{#if isOwner owner currentUser._id}}
		<h4>Requesting members:</h4>
		<ul>
		{{#each requestingMembers}}
		<li>{{getMember this}}<input class="accept-member" type="button" value="Accept" data-user="{{this}}" data-org="{{../_id}}"><input class="deny-member" type="button" value="Deny" data-user="{{this}}" data-org="{{../_id}}"></li>
		{{/each}}
		</ul>
		{{/if}}
	</li>
</template>
