<head>
	<title>gbgtech-cal</title>
</head>

<body>
	{{> header}}
	{{> menu}}

</body>

<template name="header">

</template>

<template name="home">
	{{> month}}
</template>

<template name="menu">
	<div id="menu-container" class="menu">
		<a id="menu-open" href="#" class="button" data-state="closed">Menu</a>
		<ul id="menu-list">
			<li class="menu-list-item"><a href="/" class="menu-list-item-link">Home</a></li>
			<li class="menu-list-item"><a href="/event" class="menu-list-item-link">Events</a></li>
			<li class="menu-list-item"><a href="/organization" class="menu-list-item-link">Organizations</a></li>
			<li class="menu-list-item"><a href="/event/new" class="menu-list-item-link">Create Event</a></li>
			{{#if currentUser}}
			{{#if inOrg currentUser}}
			<br />
			<li class="menu-list-item"><a href="/admin" class="menu-list-item-link">Admin Panel</a></li>
			{{/if}}
			{{/if}}
		</ul>
	</div>
</template>

<template name="month">
	<input id="prev-month" class="month-nav" type="button" value="<- Previous Month">
	<p class="month-nav">{{currentMonthAndYear}}</p>
	<input id="next-month" class="month-nav" type="button" value="Next Month ->">
	{{> loginButtons}}
	{{#if currentUser}}
	{{#if inOrg currentUser}}
	<p>You are a member of:</p> <ul>{{#each inOrg currentUser}}<li><a href="/organization/{{_id}}">{{name}}</a></li>{{/each}}</ul>
	<a href="/event/new">Create a new event</a>
	{{else}}
	<p>You are not connected to any organization, either create <a href="/organization/new">one here</a> or <a href="/organization">join one here</a></p>
	{{/if}}
	{{/if}}
	<div id="month-container">
		<table>
			<thead>
				<tr>
					<td>Monday</td>
					<td>Tuesday</td>
					<td>Wednesday</td>
					<td>Thursday</td>
					<td>Friday</td>
					<td>Saturday</td>
					<td>Sunday</td>
				</tr>
			</thead>
			<tbody id="week-container">

			</tbody>
		</table>
	</div>
</template>

<template name="week">
	<tr id="week-{{weekNbr}}"></tr>
</template>

<template name="day">
	<td id="{{id}}">{{date}}</td>
</template>

<template name="eventList">
	<a href="/event/new" class="button">New Event</a>
	<ul>
		{{#each events}}
		<li><a href="/event/{{_id}}">{{date}} - {{name}} by {{org}}</a></li>
		{{/each}}
	</ul>
</template>

<template name="eventView">
	<a href="/event" class="button">Back</a>
	<h2>{{event.name}}</h2>
	<h3>{{event.date}}</h3>
	<h4>by {{getOrg event.org}}</h4>
</template>

<template name="eventCreate">
	<form>
		<input type="text" name="eventName" placeholder="Event name" >
		<label>Organization
			<select name="org">
				{{#each organizations currentUser._id}}
				<option value="{{id}}">{{name}}</option>
				{{/each}}
			</select>
		</label>
		<label>Date
			<input class="datepicker" name="date">
		</label>
		<a href="/event" class="button">Back</a>
		<input type="submit" class="button" value="Create event">
	</form>
</template>

<template name="eventEdit">
	<form>
		<input type="text" name="eventName" placeholder="Event name" value="{{event.name}}">
		<label>Organization
			<select name="org">
				{{#each organizations currentUser._id}}
				<option value="{{id}}" {{isSelected _id ../event.org }}>{{name}}</option>
				{{/each}}
			</select>
		</label>
		<label>Date
			<input class="datepicker" name="date">
		</label>
		<a href="/admin" class="button">Back</a>
		<input type="submit" class="button" value="Edit event">
	</form>
</template>

<template name="orgList">
	<a href="/organization/new" class="button">Create new organization</a>
	<ul>
		{{#each organizations}}
		<li><a href="/organization/{{_id}}">{{name}}</a></li>	
		{{/each}}
	</ul>
</template>

<template name="orgView">
	<a href="/organization" class="button">Back</a>
	<h2>{{org.name}}</h2>
	<h3>Owner: {{getMember org.owner}}</h3>
	<h4>Members:</h4>
	<ul>
		{{#each org.members}}
		<li>{{getMember this}}</li>
		{{/each}}
	</ul>
	{{#if isMember org._id currentUser._id}}
	<p>You are a member of this organization.</p>
	{{else}}
	{{#if isRequesting org._id currentUser._id}}
	<p>You are requesting membership in this organization</p>
	{{else}}
	<input id="{{org._id}}" type="button" class="request-membership-button" value="Request membership">
	{{/if}}
	{{/if}}
	{{#if orgOwner org.owner currentUser._id}}
	<h4>Requesting members:</h4>
	<ul>
		{{#each org.requestingMembers}}
		<li>{{getMember this}}<input class="accept-member" type="button" value="Accept" data-user="{{this}}" data-org="{{../org._id}}"><input class="deny-member" type="button" value="Deny" data-user="{{this}}" data-org="{{../org._id}}"></li>
		{{/each}}
	</ul>
	{{/if}}

</template>

<template name="orgCreate">
	<form>
		<label>Owner
			<input type="text" name="orgOwner" value="{{currentUser.profile.name}}" disabled="true">
		</label>
		<input type="text" name="orgName" placeholder="Organization name" required>
		<input type="submit" class="button" value="Create Organization">
	</form>
</template>

<template name="adminPanel">
	{{#if currentUser}}
	{{#if inOrg currentUser}}
	<h2>Your organizations</h2>
	<ul>
		{{#each inOrg currentUser}}
		<li>
			<h4>{{name}}</h4>
			<a href="/organization/{{_id}}/edit" class="button">Edit</a>
			<input type="button" class="button delete" data-type="org" data-id="{{_id}}" value="Delete">
			{{#if eventsForOrg _id}}
			<h5>Upcoming events</h5>
			<ul>
				{{#each eventsForOrg _id}}
				<li>{{name}} - {{date}} <a href="/event/{{_id}}/edit" class="button tiny">Edit</a><input type="button" class="button tiny delete" data-type="event" data-id="{{_id}}" value="Delete"></li>
				{{/each}}
			</ul>

			{{else}}
			<h5>No upcoming events</h5>
			{{/if}}
		</li>
		{{/each}}
	</ul>
	{{else}}
	<h2>You are not a part of any organization and can therefore not admin any organizations or events</h2>
	{{/if}}
	{{else}}
	<h2>You are not logged in, please log in to admin organizations and events.</h2>
	{{>loginButtons}}
	{{/if}}
</template>